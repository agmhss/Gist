<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>GTK Slides Maker âš¡</title>

<script src="https://cdn.jsdelivr.net/gh/gitbrent/pptxgenjs@3.12.0/dist/pptxgen.bundle.js"></script>
<script src="https://cdn.tailwindcss.com"></script>

<script type="importmap">
{
  "imports": {
    "@google/generative-ai": "https://esm.run/@google/generative-ai"
  }
}
</script>

<style>
@media print {
  body { visibility: hidden; }
  #print-container { visibility: visible; }

  @page {
    size: A4 landscape;
    margin: 12mm 15mm;
  }

  .print-page {
    page-break-after: always;
    padding: 2.2cm 2.8cm;
  }
}
</style>
</head>

<body class="bg-sky-50 p-4 md:p-10 font-sans min-h-screen">

<div class="max-w-4xl mx-auto bg-white shadow-2xl rounded-3xl overflow-hidden border-8 border-white">

<header class="bg-gradient-to-r from-emerald-500 to-teal-600 p-8 text-white text-center">
<h1 class="text-4xl font-black">ðŸš€ GTK Slides Maker</h1>
</header>

<section id="setup-view" class="p-8 space-y-6">
<input id="api-key-input" placeholder="Gemini API Key" class="w-full p-4 border rounded-xl">
<input id="pdf-file" type="file" accept="application/pdf">
<button id="main-action-btn" class="w-full bg-emerald-600 text-white p-4 rounded-xl">
CREATE SLIDES
</button>
<div id="status-message" class="hidden"></div>
</section>

<section id="editor-view" class="hidden p-8">
<button id="generate-all-images">Generate Images</button>
<button id="download-pptx-btn">Download PPTX</button>
<button id="download-pdf-btn">Download PDF</button>
<div id="slide-editor-container"></div>
</section>

</div>

<script type="module">
import { GoogleGenerativeAI } from "@google/generative-ai";

let genAI;
let finalSlides = [];
window.finalSlides = finalSlides;

const statusEl = document.getElementById("status-message");

const STATUS_COLORS = {
  blue: "bg-blue-100 text-blue-800",
  emerald: "bg-emerald-100 text-emerald-800",
  indigo: "bg-indigo-100 text-indigo-800"
};

function showStatus(msg, color="blue") {
  statusEl.className = `p-3 rounded ${STATUS_COLORS[color]}`;
  statusEl.textContent = msg;
  statusEl.classList.remove("hidden");
}

document.getElementById("main-action-btn").onclick = async () => {
  const key = api-key-input.value.trim();
  const file = pdf-file.files[0];
  if (!key || !file) return alert("Missing inputs");

  genAI = new GoogleGenerativeAI(key);
  const model = genAI.getGenerativeModel({ model: "gemini-1.5-flash" });

  showStatus("Reading PDF...");

  const reader = new FileReader();
  reader.onload = async () => {
    const base64 = reader.result.split(",")[1];

    const result = await model.generateContent([
      { inlineData: { mimeType: "application/pdf", data: base64 } },
      { text: "Create 10 kid-friendly slides. Return JSON only." }
    ]);

    finalSlides = JSON.parse(result.response.text());
    window.finalSlides = finalSlides;

    renderSlides();
    setup-view.classList.add("hidden");
    editor-view.classList.remove("hidden");
    showStatus("Slides ready!", "emerald");
  };
  reader.readAsDataURL(file);
};

function renderSlides() {
  slide-editor-container.innerHTML = finalSlides.map((s,i)=>`
    <div class="p-4 border rounded-xl">
      <input value="${s.title}" oninput="finalSlides[${i}].title=this.value">
      <textarea oninput="finalSlides[${i}].bulletPoints=this.value.split('\\n')">
${(s.bulletPoints||[]).join("\n")}
      </textarea>
    </div>
  `).join("");
}

/* IMAGE GENERATION (Imagen) */
document.getElementById("generate-all-images").onclick = async () => {
  const model = genAI.getGenerativeModel({
    model: "imagen-3.0-generate-001"
  });

  for (const slide of finalSlides) {
    const img = await model.generateContent(slide.imagePrompt);
    slide.imageData = `data:image/png;base64,${img.response.candidates[0].content.parts[0].inlineData.data}`;
  }
};

/* PPTX */
document.getElementById("download-pptx-btn").onclick = () => {
  const pptx = new PptxGenJS();
  finalSlides.forEach(s=>{
    const slide = pptx.addSlide();
    slide.addText(s.title,{fontSize:40});
    slide.addText(s.bulletPoints,{bullet:true});
    if(s.imageData) slide.addImage({data:s.imageData});
  });
  pptx.writeFile("GTK_Slides.pptx");
};

/* PDF */
document.getElementById("download-pdf-btn").onclick = () => {
  const c = document.createElement("div");
  c.id="print-container";
  finalSlides.forEach(s=>{
    c.innerHTML += `<div class="print-page"><h1>${s.title}</h1></div>`;
  });
  document.body.appendChild(c);
  print();
  setTimeout(()=>c.remove(),2000);
};
</script>
</body>
</html>

